![image-20240428122927489](images/12장_로드밸런서/image-20240428122927489.png)

  로드밸런서는 가상 IP 주소인 VIP 를 가지고 있으며, 실제 서버들의 IP 가 VIP 에 바인딩되어 있음. 로드 밸런서에서 부하 분산 그룹을 만들 때 IP 주소뿐만 아니라 서비스 포트까지 지정해서 만들기 때문에 로드 밸런서를 L4 스위치라고 함.

**헬스 체크**

- ICMP : ping 으로 헬스 체크. 잘 사용하지 않음
- TCP 서비스 포트 : SYN, ACK 로 확인
- TCP 서비스 포트 (Half Open) : 정상적인 TCP 연결보다 빨리 헬스 체크 세션을 끊기 위해 SYN -> SYN/ACK 이후에 ACK 대신 RST 를 보내 세션을 끊음
  - ![image-20240428123337000](images/12장_로드밸런서/image-20240428123337000.png)
- HTTP 상태 코드 : 3way 핸드셰이크 이후 HTTP 를 요청해 200 OK 르 응답하는지 확인
- 콘텐츠 확인(문자열 확인) : 요청에 대한 결과값으로 상태확인

**헬스 체크 주기와 타이머**

- 주기 : 헬스 체크 패킷을 보내는 주기
- 응답 시간 : 헬스 체크 패킷을 보내고 응답을 기다리는 시간
- 시도 횟수 : 헬스 체크 실패 시 최대 시도 횟수
- 탕미아웃 :  헬스 체크 실패 시 최대 대기 시간
- 서비스 다운 시의 주기 (dead interval) : 서비스 다운 시의 헬스 체크 주기

![image-20240428125005935](images/12장_로드밸런서/image-20240428125005935.png)

# 부하 분산 알고리즘

![image-20240428125201197](images/12장_로드밸런서/image-20240428125201197.png)

# 로드 밸런서의 구성 방식

![image-20240428125816181](images/12장_로드밸런서/image-20240428125816181.png)

- 원암 구성 : 로드 밸런서가 중간 스위치 옆에 연결되는 구성. 서버로 가는 트래픽이 모두 로드밸런서를 경유하지 않아도 됨
  - 부하분산을 이용할 때는 로드밸런서를 거치고, 그렇지 않으면 로드밸런서를 거치지 않음
  - 로드밸런서 부하 감소 및 장애 영향도를 줄임
- 인라인 구성 : 서버로 가는 경로 상에 로드 밸런서가 연결
  - 구성이 직관적이고 이해하기 쉬움



